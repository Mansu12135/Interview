<ng-container [ngTemplateOutletContext]="{node: tree}" [ngTemplateOutlet]="nodes"></ng-container>
<ng-template #nodes let-node="node">
    @switch (node.type) {
        @case (TreeNodeType.Node) {
            <ng-container [ngTemplateOutletContext]="{node: node}" [ngTemplateOutletInjector]="node.injector"
                          [ngTemplateOutlet]="nodeTemplate"></ng-container>
        }
        @case (TreeNodeType.Leaf) {
            <ng-container [ngTemplateOutletContext]="{leaf: node}" [ngTemplateOutletInjector]="node.injector"
                          [ngTemplateOutlet]="leafTemplate"></ng-container>
        }
    }
</ng-template>

<ng-template #nodeTemplate let-node="node">
    <colored-content>
        <div (click)="toggleNodeSelecting(node.id, $event)" [class.selected]="node.isSelected"
             class="element node">
            <strong>
                <span class="title">{{ node.title }}</span>
                <span class="id-badge">#{{ node.id }}</span>
            </strong>
            @for (child of node["children"]; track child.id) {
                <ng-container [ngTemplateOutletContext]="{node: child}" [ngTemplateOutlet]="nodes"></ng-container>
            }
        </div>
    </colored-content>
</ng-template>

<ng-template #leafTemplate let-leaf="leaf">
    <colored-content>
        <div (click)="toggleNodeSelecting(leaf.id, $event)" [class.selected]="leaf.isSelected"
             class="element leaf">
            <i>
                <span class="title">{{ leaf.title }}</span>
                <span class="meta">({{ leaf.value }})</span>
                <span class="id-badge">#{{ leaf.id }}</span>
            </i>
        </div>
    </colored-content>
</ng-template>

